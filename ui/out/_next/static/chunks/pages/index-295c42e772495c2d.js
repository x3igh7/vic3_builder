(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(9502)}])},8961:function(e,t,n){"use strict";var o=n(7294);t.Z=()=>{let[e,t]=(0,o.useState)([]),[n,r]=(0,o.useState)([]),[u,i]=(0,o.useState)([]);return(0,o.useEffect)(()=>{fetch("data/buildings.json").then(e=>e.json()).then(e=>t(e)),fetch("data/production_method_groups.json").then(e=>e.json()).then(e=>r(e)),fetch("data/production_methods.json").then(e=>e.json()).then(e=>i(e))},[]),{buildings:e,productionMethodGroups:n,productionMethods:u}}},9502:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return q}});var o=n(4386),r=n(7294),u=n(7154),i=n(4182),d=n(917),a=e=>{let{buildings:t,selectedBuilding:n,buildingQuantity:a,onSelectedBuildingChange:l,onBuildingQuantityChange:s}=e,[c,m]=(0,r.useState)(),[h,g]=(0,r.useState)([]);return(0,r.useEffect)(()=>{g(t)},[t]),(0,r.useEffect)(()=>{n&&m(n.name)},[n]),(0,o.BX)("div",{children:[(0,o.BX)("div",{css:(0,d.iv)({marginBottom:"1rem"}),children:[(0,o.tZ)("label",{htmlFor:"buildingSelector",css:(0,d.iv)({marginRight:"1rem"}),children:"Building Type"}),(0,o.tZ)(u.Q,{inputId:"buildingSelector",field:"name",suggestions:h,value:c,completeMethod:e=>{g(t.filter(t=>t.name.toLowerCase().includes(e.query.toLowerCase())))},onChange:e=>{m(e.value)},onSelect:e=>{l(e.value)},dropdown:!0,dropdownMode:"current",forceSelection:!0})]}),(0,o.BX)("div",{children:[(0,o.tZ)("label",{htmlFor:"quantityInput",css:(0,d.iv)({marginRight:"1rem"}),children:"Quantity"}),(0,o.tZ)(i.R,{inputId:"quantityInput",value:a,onChange:e=>{s(e.value)}})]})]})},l=n(8961);let s=e=>e.sort((e,t)=>e.reduce((e,t)=>e+t.quantity,0)-t.reduce((e,t)=>e+t.quantity,0)),c=e=>e.production_method_groups.flatMap(e=>e.currentMethod.inputs?e.currentMethod.inputs:[]).reduce((e,t)=>e.some(e=>e.good===t.good)?[...e.map(e=>(e.good===t.good&&(e.amount+=t.amount),e))]:[...e,t],[]),m=e=>e.production_method_groups.flatMap(e=>e.currentMethod.outputs?e.currentMethod.outputs.map(e=>e):[]).reduce((e,t)=>e.some(e=>e.good===t.good)?[...e.map(e=>{let n=e.amount;return e.good===t.good&&(n+=t.amount),{...e,amount:n}})]:[...e,t],[]),h=(e,t)=>t.filter(t=>t.production_method_groups.some(t=>{var n;return null===(n=t.currentMethod.outputs)||void 0===n?void 0:n.some(t=>t.good===e)})),g=(e,t)=>{let n=e.production_method_groups.filter(e=>{var n;return null===(n=e.currentMethod.outputs)||void 0===n?void 0:n.some(e=>e.good===t)}).reduce((e,n)=>{var o;return e+((null===(o=n.currentMethod.outputs)||void 0===o?void 0:o.reduce((e,n)=>n.good===t?e+n.amount:e,0))||0)},0);return{good:t,amount:n}},p=e=>e.flatMap(e=>[...e.totalInputs.map(e=>({...e}))]).reduce((e,t)=>e.some(e=>e.good===t.good)?[...e.map(e=>(e.good===t.good&&(e.amount+=t.amount),e))]:[...e,t],[]),f=e=>e.flatMap(e=>[...e.totalOutputs.map(e=>({...e}))]).reduce((e,t)=>e.some(e=>e.good===t.good)?[...e.map(e=>(e.good===t.good&&(e.amount+=t.amount),e))]:[...e,t],[]),v=e=>{let t=p(e),n=f(e);return t.map(e=>{let t=n.find(t=>t.good===e.good);return t?{good:e.good,amount:t.amount-e.amount}:{good:e.good,amount:0-e.amount}})},_=e=>{var t;return[...(null==e?void 0:e.unlocking_technologies)||[],...null===(t=e.production_method_groups)||void 0===t?void 0:t.flatMap(e=>{var t;return(null===(t=e.currentMethod)||void 0===t?void 0:t.unlocking_technologies)||[]})]},B=e=>e.filter(e=>{if(v(e).filter(e=>e.amount<0).length>0)return e}),Z=(e,t,n,o)=>{let r=Math.ceil(-1*e.amount/t.amount),u=n.find(e=>e.name===o.name),i=u?u.quantity+r:r,d=m(o).map(e=>({...e,amount:e.amount*i})),a=c(o).map(e=>({...e,amount:e.amount*i}));return{name:o.name,requiredTechs:(null==u?void 0:u.requiredTechs)||_(o)||[],quantity:i,totalInputs:a,totalOutputs:d}},X=(e,t)=>{let n=B(e);if(!n.length)return e;let o=n[0],r=e.filter(e=>e!==o),u=v(o).filter(e=>e.amount<0);if(!u.length)return e;let i=u[0],d=h(i.good,t);if(!d.length)return e;let a=d.find(e=>o.some(t=>t.name===e.name));a||(a=d[0]),d.length>1&&d.filter(e=>e.name!==a.name).forEach(t=>{if(e.some(e=>e.some(e=>e.name===t.name)))return;let n=o.map(e=>({...e})),u=Z(i,g(t,i.good),n,t);r.push([...n,u])});let l=g(a,i.good),s=Z(i,l,o,a);return X([...r,[...o.filter(e=>e.name!==s.name),s]],t)},y=(e,t,n)=>{let o={...n.find(t=>t.name===e.name)},r=c(o).map(e=>{let n=e.amount*t;return{...e,amount:n}}),u=m(o).map(e=>{let n=e.amount*t;return{...e,amount:n}}),i=[];return i.push({name:o.name,requiredTechs:_(o),quantity:t,totalInputs:r,totalOutputs:u}),X([i],n)};var M=n(3308),b=e=>{let{selectedBuilding:t,quantity:n}=e,[u]=(0,M._)([],"settings_v3"),[i,a]=(0,r.useState)([]);(0,r.useEffect)(()=>{if(t&&n&&u.length){let e=y(t,n,u);a([...e=s(e)])}},[t,n,u]);let l=e=>e.map(e=>(0,o.BX)("div",{css:(0,d.iv)({"> *":{marginRight:"1rem"}}),children:[(0,o.BX)("label",{children:[e.name,": "]}),(0,o.tZ)("span",{css:(0,d.iv)({color:"#9eade6"}),children:e.quantity})]},e.name)),c=e=>{let t=v(e),n=f(e);return t.map(e=>{var t;let r=e.amount<0?"red":"green",u=(null===(t=n.find(t=>t.good===e.good))||void 0===t?void 0:t.amount)||0;return(0,o.BX)("div",{css:(0,d.iv)({"> *":{marginRight:"1rem"}}),children:[(0,o.tZ)("label",{children:e.good}),(0,o.BX)("span",{css:{color:"var(--text-color-secondary)"},children:["Total: ",u]}),(0,o.BX)("span",{css:{color:r},children:["Excess: ",e.amount]})]},e.good)})},m=e=>f(e).map(e=>(0,o.BX)("div",{css:(0,d.iv)({"> *":{marginRight:"1rem"}}),children:[(0,o.tZ)("label",{children:e.good}),(0,o.tZ)("span",{css:{color:"var(--text-color-secondary)"},children:e.amount})]},e.good)),h=e=>{let t=Array.from(new Set(e.flatMap(e=>e.requiredTechs)||[]));return t.length?t.map(e=>(0,o.tZ)("div",{children:(0,o.tZ)("label",{children:e})},e)):(0,o.tZ)("div",{children:"No technologies required"})};return t&&n?(0,o.BX)("div",{children:[(0,o.tZ)("h2",{children:"Building Chain Results"}),i.map((e,t)=>(0,o.BX)("div",{css:(0,d.iv)({display:"flex",flexDirection:"row",flexWrap:"wrap",gap:"1rem"}),children:[(0,o.BX)("div",{css:(0,d.iv)({flex:"1 auto"}),children:[(0,o.tZ)("h3",{children:"Buildings"}),l(e)]}),(0,o.BX)("div",{css:(0,d.iv)({flex:"1 auto"}),children:[(0,o.tZ)("h3",{children:"Input Deltas"}),c(e)]}),(0,o.BX)("div",{css:(0,d.iv)({flex:"1 auto"}),children:[(0,o.tZ)("h3",{children:"Outputs"}),m(e)]}),(0,o.BX)("div",{css:(0,d.iv)({flex:"1 auto"}),children:[(0,o.tZ)("h3",{children:"Required Technologies"}),h(e)]})]},t))]}):(0,o.tZ)("div",{})};function q(){let[e,t]=(0,M.Xs)(void 0,"buildingSelected"),[n,r]=(0,M.Xs)(5,"buildingQuantity"),{buildings:u}=(0,l.Z)();return(0,o.BX)("main",{children:[(0,o.tZ)("h1",{children:"Vic3 Builder"}),(0,o.tZ)(a,{buildings:u,selectedBuilding:e,buildingQuantity:n,onSelectedBuildingChange:e=>{t(e)},onBuildingQuantityChange:e=>{r(e)}}),(0,o.tZ)(b,{selectedBuilding:e,quantity:n})]})}}},function(e){e.O(0,[154,182,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);